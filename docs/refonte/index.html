<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digital Humans ‚Äî Documentation Technique</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0c0f14;
    --bg-card: #151922;
    --bg-card-hover: #1a1f2b;
    --bg-sidebar: #10131a;
    --border: #1e2433;
    --text: #c8cdd8;
    --text-dim: #6b7280;
    --text-bright: #eef0f4;
    --accent: #4f8cff;
    --accent-dim: #2a4a8a;
    --green: #34d399;
    --green-dim: rgba(52,211,153,0.12);
    --red: #f87171;
    --red-dim: rgba(248,113,113,0.12);
    --orange: #fb923c;
    --orange-dim: rgba(251,146,60,0.12);
    --purple: #a78bfa;
    --purple-dim: rgba(167,139,250,0.12);
    --yellow: #fbbf24;
    --cyan: #22d3ee;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.65;
    display: flex;
    min-height: 100vh;
  }

  /* Sidebar */
  .sidebar {
    width: 280px;
    min-height: 100vh;
    background: var(--bg-sidebar);
    border-right: 1px solid var(--border);
    padding: 24px 0;
    position: fixed;
    top: 0;
    left: 0;
    overflow-y: auto;
    z-index: 100;
  }

  .sidebar-header {
    padding: 0 24px 24px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 16px;
  }

  .sidebar-header h1 {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-bright);
    letter-spacing: -0.3px;
  }

  .sidebar-header .subtitle {
    font-size: 12px;
    color: var(--text-dim);
    margin-top: 4px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .nav-section {
    padding: 8px 16px;
  }

  .nav-section-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    color: var(--text-dim);
    padding: 8px;
    margin-top: 8px;
  }

  .nav-link {
    display: block;
    padding: 8px 12px;
    border-radius: 8px;
    color: var(--text);
    text-decoration: none;
    font-size: 14px;
    font-weight: 400;
    transition: all 0.15s;
    cursor: pointer;
  }

  .nav-link:hover { background: var(--bg-card); color: var(--text-bright); }
  .nav-link.active { background: var(--accent-dim); color: var(--accent); font-weight: 500; }

  /* Main */
  .main {
    margin-left: 280px;
    flex: 1;
    padding: 48px 64px;
    max-width: 960px;
  }

  .section { display: none; }
  .section.active { display: block; }

  h2 {
    font-size: 28px;
    font-weight: 700;
    color: var(--text-bright);
    letter-spacing: -0.5px;
    margin-bottom: 8px;
  }

  h3 {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-bright);
    margin-top: 36px;
    margin-bottom: 12px;
  }

  h4 {
    font-size: 15px;
    font-weight: 600;
    color: var(--accent);
    margin-top: 24px;
    margin-bottom: 8px;
  }

  .section-desc {
    font-size: 15px;
    color: var(--text-dim);
    margin-bottom: 32px;
    line-height: 1.5;
  }

  p { margin-bottom: 16px; }

  /* Cards */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 20px;
    transition: border-color 0.2s;
  }
  .card:hover { border-color: var(--accent-dim); }

  .card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .card-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
  }

  .card-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-bright);
  }

  .card-subtitle {
    font-size: 12px;
    color: var(--text-dim);
  }

  /* Agent cards */
  .agent-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }

  .agent-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s;
  }
  .agent-card:hover { border-color: var(--accent-dim); transform: translateY(-2px); }

  .agent-name { font-weight: 600; color: var(--text-bright); font-size: 15px; }
  .agent-role { font-size: 13px; color: var(--accent); margin-bottom: 8px; }
  .agent-file { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-dim); margin-bottom: 8px; }
  .agent-desc { font-size: 13px; color: var(--text); line-height: 1.5; }

  /* Tags */
  .tag {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .tag-critical { background: var(--red-dim); color: var(--red); }
  .tag-major { background: var(--orange-dim); color: var(--orange); }
  .tag-medium { background: var(--purple-dim); color: var(--purple); }
  .tag-done { background: var(--green-dim); color: var(--green); }
  .tag-pending { background: rgba(107,114,128,0.15); color: var(--text-dim); }
  .tag-active { background: var(--orange-dim); color: var(--orange); }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0 24px;
    font-size: 14px;
  }
  th {
    text-align: left;
    padding: 10px 14px;
    background: var(--bg-card);
    color: var(--text-dim);
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border);
  }
  td {
    padding: 10px 14px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
  }
  tr:hover td { background: rgba(79,140,255,0.03); }

  /* Code */
  code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    background: rgba(79,140,255,0.08);
    padding: 2px 7px;
    border-radius: 5px;
    color: var(--accent);
  }

  pre {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    overflow-x: auto;
    margin: 16px 0 24px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    line-height: 1.6;
    color: var(--text);
  }

  /* Mermaid */
  .mermaid-wrapper {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 32px 24px;
    margin: 20px 0 28px;
    overflow-x: auto;
  }
  .mermaid { display: flex; justify-content: center; }
  .mermaid svg { max-width: 100%; }

  /* Stats row */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
  }
  .stat-value { font-size: 32px; font-weight: 700; color: var(--text-bright); }
  .stat-label { font-size: 12px; color: var(--text-dim); margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

  /* Timeline */
  .timeline { position: relative; padding-left: 28px; margin: 24px 0; }
  .timeline::before {
    content: '';
    position: absolute;
    left: 8px;
    top: 4px;
    bottom: 4px;
    width: 2px;
    background: var(--border);
  }
  .timeline-item { position: relative; margin-bottom: 28px; }
  .timeline-item::before {
    content: '';
    position: absolute;
    left: -24px;
    top: 6px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid var(--accent);
    background: var(--bg);
  }
  .timeline-item.done::before { background: var(--green); border-color: var(--green); }
  .timeline-item.active::before { background: var(--accent); border-color: var(--accent); box-shadow: 0 0 8px var(--accent); }
  .timeline-date { font-size: 12px; color: var(--text-dim); font-weight: 500; }
  .timeline-title { font-size: 15px; font-weight: 600; color: var(--text-bright); margin: 4px 0; }
  .timeline-desc { font-size: 13px; color: var(--text); }

  /* Services status */
  .service-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 0;
    border-bottom: 1px solid var(--border);
  }
  .service-name { font-weight: 500; color: var(--text-bright); }
  .service-port { font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--text-dim); }
  .status-dot {
    width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px;
  }
  .status-dot.active { background: var(--green); box-shadow: 0 0 6px var(--green); }
  .status-dot.inactive { background: var(--red); }
  .status-dot.partial { background: var(--orange); }

  /* Responsive */
  @media (max-width: 900px) {
    .sidebar { display: none; }
    .main { margin-left: 0; padding: 24px; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .agent-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<nav class="sidebar">
  <div class="sidebar-header">
    <h1>ü§ñ Digital Humans</h1>
    <div class="subtitle">Documentation technique</div>
  </div>
  <div class="nav-section">
    <div class="nav-section-title">G√©n√©ral</div>
    <a class="nav-link active" onclick="showSection('overview')">Vue d'ensemble</a>
    <a class="nav-link" onclick="showSection('architecture')">Architecture</a>
    <a class="nav-link" onclick="showSection('agents')">Les 11 Agents</a>
  </div>
  <div class="nav-section">
    <div class="nav-section-title">Flux m√©tier</div>
    <a class="nav-link" onclick="showSection('sds-flow')">Phase SDS</a>
    <a class="nav-link" onclick="showSection('build-flow')">Phase BUILD</a>
    <a class="nav-link" onclick="showSection('hitl')">HITL & Chat</a>
    <a class="nav-link" onclick="showSection('rag')">RAG & Knowledge</a>
  </div>
  <div class="nav-section">
    <div class="nav-section-title">Infrastructure</div>
    <a class="nav-link" onclick="showSection('infra')">Services & Ports</a>
    <a class="nav-link" onclick="showSection('database')">Base de donn√©es</a>
    <a class="nav-link" onclick="showSection('api')">API Reference</a>
    <a class="nav-link" onclick="showSection('frontend')">Frontend</a>
  </div>
  <div class="nav-section">
    <div class="nav-section-title">Refonte 2026</div>
    <a class="nav-link" onclick="showSection('problems')">Probl√®mes (P0-P9)</a>
    <a class="nav-link" onclick="showSection('refonte')">Plan de refonte</a>
    <a class="nav-link" onclick="showSection('journal')">Journal</a>
  </div>
</nav>

<main class="main">

  <!-- ==================== VUE D'ENSEMBLE ==================== -->
  <div id="overview" class="section active">
    <h2>Vue d'ensemble</h2>
    <p class="section-desc">
      Digital Humans est une plateforme SaaS B2B qui automatise le d√©veloppement Salesforce gr√¢ce √† 11 agents IA sp√©cialis√©s. Le syst√®me g√©n√®re des sp√©cifications compl√®tes (SDS) puis du code Salesforce d√©ployable (BUILD) via un pipeline multi-phases orchestr√© avec validation humaine √† chaque √©tape cl√©.
    </p>
    <div class="card-grid">
      <div class="card">
        <h4>Pipeline SDS (5 phases)</h4>
        <p>Sophie ‚Üí Olivia ‚Üí Emma ‚Üí Marcus ‚Üî Emma ‚Üí Experts ‚Üí SDS</p>
        <p style="margin-top:8px"><span class="tag tag-active">193 fichiers Python</span> <span class="tag" style="background:var(--purple-dim);color:var(--purple)">40 fichiers React</span></p>
      </div>
      <div class="card">
        <h4>Pipeline BUILD (6 phases, 4 agents)</h4>
        <p>Raj ‚Üí Diego ‚Üí Zara ‚Üí Raj ‚Üí Raj ‚Üí Aisha + Jordan (deploy) + Elena (review)</p>
        <p style="margin-top:8px"><span class="tag tag-done">Sonnet 4.5 pour tous</span> <span class="tag tag-critical">Opus pour architecture</span></p>
      </div>
      <div class="card">
        <h4>Worker async (ARQ + Redis)</h4>
        <p>Toutes les ex√©cutions SDS/BUILD tournent en background via ARQ workers avec suivi temps r√©el via polling/SSE</p>
        <p style="margin-top:8px"><span class="tag tag-done">3 t√¢ches : SDS, Resume, Build</span></p>
      </div>
      <div class="card">
        <h4>HITL ‚Äî Human in the Loop</h4>
        <p>5 gates de validation (BR, Architecture, Experts, SDS, BUILD) + chat contextuel multi-agent (9 agents)</p>
        <p style="margin-top:8px"><span class="tag tag-active">State Machine 27 √©tats</span></p>
      </div>
    </div>

    <h3>Stack technique</h3>
    <table>
      <tr><th>Couche</th><th>Technologie</th><th>Port</th><th>R√¥le</th></tr>
      <tr><td>Backend API</td><td>FastAPI + SQLAlchemy + Uvicorn</td><td>8002</td><td>REST API, orchestration</td></tr>
      <tr><td>Worker</td><td>ARQ + Redis</td><td>‚Äî</td><td>Ex√©cutions async SDS/BUILD</td></tr>
      <tr><td>Frontend</td><td>React 18 + Vite + TailwindCSS</td><td>3000</td><td>Interface utilisateur SPA</td></tr>
      <tr><td>Base de donn√©es</td><td>PostgreSQL 16</td><td>5432</td><td>41 tables, √©tat complet</td></tr>
      <tr><td>Queue</td><td>Redis 7</td><td>6379</td><td>Job queue ARQ + cache</td></tr>
      <tr><td>RAG</td><td>ChromaDB (PersistentClient)</td><td>‚Äî</td><td>70,251 chunks, 1.4 GB, 5 collections</td></tr>
      <tr><td>LLM local</td><td>Ollama + Mistral 7B</td><td>11434</td><td>D√©sactiv√© ‚Äî non n√©cessaire actuellement (√©conomie RAM)</td></tr>
      <tr><td>LLM cloud</td><td>Anthropic Claude API</td><td>‚Äî</td><td>Opus 4.6 (Sophie, Marcus), Sonnet 4.5 (9 autres agents)</td></tr>
      <tr><td>CMS</td><td>Ghost</td><td>2368</td><td>Site marketing digital-humans.fr</td></tr>
      <tr><td>Automation</td><td>N8N</td><td>5678</td><td>Workflows marketing</td></tr>
      <tr><td>Reverse proxy</td><td>Nginx</td><td>80/443</td><td>SSL, routing, static files</td></tr>
    </table>

    <h3>Repo & Serveur</h3>
    <table>
      <tr><th>√âl√©ment</th><th>Valeur</th></tr>
      <tr><td>VPS</td><td><code>72.61.161.222</code> ‚Äî Ubuntu 24.04 ‚Äî Hostinger</td></tr>
      <tr><td>Repo</td><td><code>github.com/SamHATIT/digital-humans-production</code></td></tr>
      <tr><td>Services</td><td><code>digital-humans-backend</code>, <code>digital-humans-worker</code>, <code>digital-humans-frontend</code> (systemctl)</td></tr>
      <tr><td>Workspace</td><td><code>/root/workspace/digital-humans-production</code></td></tr>
    </table>
  </div>

  <!-- ==================== ARCHITECTURE ==================== -->
  <div id="architecture" class="section">
    <h2>Architecture</h2>
    <p class="section-desc">Architecture 3-tier avec orchestrateur central, workers async, et state machine pour g√©rer les transitions de phase.</p>

    <h3>Architecture globale</h3>
    <div class="mermaid-wrapper">
      <pre class="mermaid">
flowchart TB
    subgraph Client["Frontend React :3000"]
        UI[Pages & Components]
    end
    subgraph API["FastAPI Backend :8002"]
        Routes[API Routes ‚Äî 178 endpoints]
        Orch[Orchestrator Service]
        SM[State Machine ‚Äî 27 √©tats]
        Budget[BudgetService + CircuitBreaker]
        LLM[LLM Router ‚Äî YAML config]
        VGS[Validation Gate Service]
    end
    subgraph Worker["ARQ Worker ‚Äî systemctl"]
        W1[execute_sds_task]
        W2[resume_architecture_task]
        W3[execute_build_task]
    end
    subgraph Storage["Persistence"]
        PG[(PostgreSQL ‚Äî 41 tables)]
        Redis[(Redis ‚Äî Job Queue)]
        Chroma[(ChromaDB PersistentClient ‚Äî 70K chunks)]
    end
    subgraph LLMs["LLM Providers"]
        Opus[Claude Opus 4.6 ‚Äî Marcus Sophie]
        Sonnet[Claude Sonnet 4.5 ‚Äî SDS agents]
        Haiku[Claude Haiku ‚Äî non utilis√©]
        Mistral[Ollama Mistral 7B ‚Äî D√©sactiv√©]
    end
    UI -->|REST API| Routes
    Routes --> Orch
    Orch --> SM
    Orch --> Budget
    Orch --> VGS
    Orch -->|enqueue| Redis
    Redis -->|dequeue| Worker
    Worker --> LLM
    LLM --> LLMs
    Worker --> PG
    Routes --> PG
    Worker --> Chroma
    style Client fill:#151922,stroke:#4f8cff
    style API fill:#151922,stroke:#34d399
    style Worker fill:#151922,stroke:#fb923c
    style Storage fill:#151922,stroke:#a78bfa
    style LLMs fill:#151922,stroke:#f87171
      </pre>
    </div>

    <h3>Couches applicatives</h3>
    <table>
      <tr><th>Couche</th><th>Fichiers cl√©s</th><th>Responsabilit√©</th></tr>
      <tr><td>Routes API</td><td><code>orchestrator/*.py</code>, <code>hitl_routes.py</code>, <code>deliverables.py</code></td><td>29 fichiers, 178 endpoints REST</td></tr>
      <tr><td>Services</td><td><code>pm_orchestrator_service_v2.py</code>, <code>budget_service.py</code>, <code>execution_state.py</code></td><td>Logique m√©tier, orchestration phases</td></tr>
      <tr><td>Workers</td><td><code>workers/tasks.py</code>, <code>workers/worker.py</code></td><td>ARQ tasks async : SDS, Resume, BUILD</td></tr>
      <tr><td>Agents</td><td><code>agents/roles/*.py</code> (11 fichiers)</td><td>Prompts YAML, appels LLM, parsing r√©ponses</td></tr>
      <tr><td>State Machine</td><td><code>execution_state.py</code></td><td>27 √©tats, transitions contr√¥l√©es, persistence DB</td></tr>
      <tr><td>LLM Routing</td><td><code>llm_routing.yaml</code>, <code>llm_router_service.py</code></td><td>agent_complexity_map ‚Üí mod√®le</td></tr>
      <tr><td>Budget</td><td><code>budget_service.py</code></td><td>Estimation co√ªts, suivi tokens, CircuitBreaker</td></tr>
    </table>
  </div>
  <!-- ==================== LES 11 AGENTS ==================== -->
  <div id="agents" class="section">
    <h2>Les 11 Agents</h2>
    <p class="section-desc">Chaque agent est un fichier Python dans <code>agents/roles/</code>. Le routage LLM est centralis√© dans <code>llm_routing.yaml</code> via l'<code>agent_complexity_map</code>.</p>

    <h3>Pipeline des agents</h3>
    <div class="mermaid-wrapper">
      <pre class="mermaid">
flowchart LR
    subgraph SDS["Pipeline SDS"]
        direction LR
        S[Sophie ‚Äî PM] -->|BRs| O[Olivia ‚Äî BA]
        O -->|UCs| E1[Emma ‚Äî UC Digest]
        E1 --> M[Marcus ‚Äî Architect]
        M --> E2[Emma ‚Äî Coverage]
        E2 -->|score < 85%| M
        E2 -->|score ‚â• 85%| EXP
        subgraph EXP["Phase 4 ‚Äî 4 Experts parall√®le"]
            direction TB
            EL[Elena QA]
            JO[Jordan DevOps]
            AI[Aisha Data]
            LU[Lucas Training]
        end
        EXP --> E3[Emma ‚Äî SDS Write]
    end
    style S fill:#8b5cf6,color:#fff
    style M fill:#3b82f6,color:#fff
    style E1 fill:#06b6d4,color:#fff
    style E2 fill:#06b6d4,color:#fff
    style E3 fill:#06b6d4,color:#fff
      </pre>
    </div>

    <h3>Fiches agents</h3>
    <table>
      <tr><th>Agent</th><th>R√¥le</th><th>Phase SDS</th><th>Phase BUILD</th><th>Mod√®le LLM</th><th>agent_type</th></tr>
      <tr><td><strong>Sophie</strong></td><td>Project Manager</td><td>1 ‚Äî BR extraction</td><td>‚Äî</td><td>Opus 4.6</td><td><code>pm</code> ‚Üí critical</td></tr>
      <tr><td><strong>Olivia</strong></td><td>Business Analyst</td><td>2 ‚Äî Use Cases</td><td>‚Äî</td><td>Sonnet 4.5</td><td><code>business_analyst</code> ‚Üí complex</td></tr>
      <tr><td><strong>Emma</strong></td><td>Research Analyst</td><td>2.5 / 3.3 / 4.5 / 5</td><td>‚Äî</td><td>Sonnet 4.5</td><td><code>research_analyst</code> ‚Üí complex</td></tr>
      <tr><td><strong>Marcus</strong></td><td>Solution Architect</td><td>3 ‚Äî Architecture</td><td>‚Äî</td><td>Opus 4.6</td><td><code>architect</code> ‚Üí critical</td></tr>
      <tr><td><strong>Elena</strong></td><td>QA Engineer</td><td>4 ‚Äî Test specs</td><td>‚Äî</td><td>Sonnet 4.5</td><td><code>qa_tester</code></td></tr>
      <tr><td><strong>Jordan</strong></td><td>DevOps / CI-CD</td><td>4 ‚Äî DevOps specs</td><td>Deploy (toutes phases)</td><td>Sonnet 4.5</td><td><code>devops</code></td></tr>
      <tr><td><strong>Raj</strong></td><td>Admin Config</td><td>‚Äî</td><td>1,4,5 ‚Äî Model/Auto/Security</td><td>Sonnet 4.5</td><td><code>admin</code></td></tr>
      <tr><td><strong>Diego</strong></td><td>Apex Developer</td><td>‚Äî</td><td>2 ‚Äî Business logic</td><td>Sonnet 4.5</td><td><code>apex_developer</code></td></tr>
      <tr><td><strong>Zara</strong></td><td>LWC Developer</td><td>‚Äî</td><td>3 ‚Äî UI components</td><td>Sonnet 4.5</td><td><code>lwc_developer</code></td></tr>
      <tr><td><strong>Aisha</strong></td><td>Data Migration</td><td>4 ‚Äî Data specs</td><td>6 ‚Äî Migration scripts</td><td>Sonnet 4.5</td><td><code>data</code></td></tr>
      <tr><td><strong>Lucas</strong></td><td>Trainer</td><td>4 ‚Äî Training specs</td><td>‚Äî</td><td>Sonnet</td><td><code>trainer</code></td></tr>
    </table>

    <h3>Routage LLM (<code>llm_routing.yaml</code>)</h3>
    <table>
      <tr><th>Complexit√©</th><th>Mod√®le</th><th>Pricing (in/out per M)</th><th>Agents</th></tr>
      <tr><td><code>critical</code></td><td>Claude Opus 4.6</td><td>$5 / $25</td><td>Sophie, Marcus</td></tr>
      <tr><td><code>complex</code></td><td>Claude Sonnet 4.5</td><td>$3 / $15</td><td>Olivia, Emma, Elena (qa), Jordan (devops), Raj (admin), Aisha (data), Lucas, Diego, Zara</td></tr>
      <tr><td><code>medium</code></td><td>Claude Haiku</td><td>$1 / $5</td><td>(non utilis√© actuellement)</td></tr>
      <tr><td><code>simple</code></td><td>Ollama Mistral 7B</td><td>Gratuit (local)</td><td>D√©sactiv√© ‚Äî aucun agent mapp√© √† ce tier</td></tr>
    </table>
  </div>

  <!-- ==================== PIPELINE SDS ==================== -->
  <div id="sds-flow" class="section">
    <h2>Phase SDS ‚Äî Sp√©cification</h2>
    <p class="section-desc">Le pipeline SDS transforme un document m√©tier en sp√©cification Salesforce compl√®te via 5 phases avec validation humaine (HITL).</p>

    <h3>State Machine SDS (27 √©tats)</h3>
    <div class="mermaid-wrapper">
      <pre class="mermaid">
stateDiagram-v2
    [*] --> queued
    queued --> sds_phase1_running : start
    state "Phase 1 ‚Äî Sophie (BRs)" as sds_phase1_running
    sds_phase1_running --> waiting_br_validation
    state "‚è∏ HITL: Valider BRs" as waiting_br_validation
    waiting_br_validation --> sds_phase2_running : approve
    state "Phase 2 ‚Äî Olivia (UCs)" as sds_phase2_running
    sds_phase2_running --> sds_phase2_5_running
    state "Phase 2.5 ‚Äî Emma (UC Digest)" as sds_phase2_5_running
    sds_phase2_5_running --> sds_phase3_running
    state "Phase 3 ‚Äî Marcus (Architecture)" as sds_phase3_running
    sds_phase3_running --> coverage_check
    state "Phase 3.3 ‚Äî Emma (Coverage)" as coverage_check
    coverage_check --> waiting_architecture_validation : score ‚â• 85%
    coverage_check --> sds_phase3_running : score < 85% fix_gaps
    state "‚è∏ HITL: Review Architecture" as waiting_architecture_validation
    waiting_architecture_validation --> sds_phase3_running : revise
    waiting_architecture_validation --> sds_phase4_running : approve
    state "Phase 4 ‚Äî 4 Experts parall√®le" as sds_phase4_running
    sds_phase4_running --> waiting_expert_validation
    state "‚è∏ HITL: Review Experts" as waiting_expert_validation
    waiting_expert_validation --> sds_phase5_running : approve
    state "Phase 5 ‚Äî Emma (SDS Write)" as sds_phase5_running
    sds_phase5_running --> sds_complete
    sds_complete --> waiting_sds_validation
    state "‚è∏ HITL: Valider SDS" as waiting_sds_validation
      </pre>
    </div>

    <h3>HITL Validation Gates</h3>
    <table>
      <tr><th>Gate</th><th>√âtat State Machine</th><th>Action utilisateur</th><th>Endpoint</th></tr>
      <tr><td>Apr√®s Phase 1</td><td><code>WAITING_BR_VALIDATION</code></td><td>√âditer/valider BRs, modifier priorit√©s</td><td><code>POST .../validation-gate/submit</code></td></tr>
      <tr><td>Apr√®s Phase 3.3</td><td><code>WAITING_ARCHITECTURE_VALIDATION</code></td><td>Review ERD, Flows, WBS ‚Üí Approve ou Revise</td><td><code>POST .../resume</code></td></tr>
      <tr><td>Apr√®s Phase 4</td><td><code>WAITING_EXPERT_VALIDATION</code></td><td>Valider specs QA, Admin, Data, DevOps, Training</td><td><code>POST .../validation-gate/submit</code></td></tr>
      <tr><td>Apr√®s Phase 5</td><td><code>WAITING_SDS_VALIDATION</code></td><td>Valider SDS final, t√©l√©charger DOCX</td><td><code>POST .../validation-gate/submit</code></td></tr>
      <tr><td>Apr√®s BUILD</td><td><code>WAITING_BUILD_VALIDATION</code></td><td>Valider code avant d√©ploiement</td><td><code>POST .../validation-gate/submit</code></td></tr>
    </table>

    <h3>R√©vision Architecture (fix_gaps)</h3>
    <p>Quand Emma d√©tecte un coverage &lt; 85%, elle g√©n√®re des gaps (<code>what_is_missing</code> + <code>fix_instruction</code>). Marcus re√ßoit ces gaps en mode <code>fix_gaps</code> (incr√©mental). Boucle auto-revision max 3 it√©rations.</p>
  </div>
  <!-- ==================== PIPELINE BUILD ==================== -->
  <div id="build-flow" class="section">
    <h2>Phase BUILD ‚Äî G√©n√©ration de code</h2>
    <p class="section-desc">Le BUILD transforme les specs SDS en code Salesforce d√©ployable. Chaque agent BUILD utilise Sonnet 4.5 et re√ßoit les specs d√©taill√©es de Marcus comme contexte. Raj (Admin) intervient sur 3 phases, Jordan orchestre le d√©ploiement de chaque phase via JordanDeployService, et Elena review chaque output avant deploy.</p>

    <h3>Flux BUILD</h3>
    <div class="mermaid-wrapper">
      <pre class="mermaid">
flowchart LR
    SDS[SDS Valid√©] --> P1[Phase 1 ‚Äî Raj<br/>Data Model]
    P1 --> P2[Phase 2 ‚Äî Diego<br/>Business Logic]
    P2 --> P3[Phase 3 ‚Äî Zara<br/>UI Components]
    P3 --> P4[Phase 4 ‚Äî Raj<br/>Automation]
    P4 --> P5[Phase 5 ‚Äî Raj<br/>Security]
    P5 --> P6[Phase 6 ‚Äî Aisha<br/>Data Migration]
    P6 --> DONE[BUILD Complete]
    style P1 fill:#6366f1,color:#fff
    style P2 fill:#f87171,color:#fff
    style P3 fill:#34d399,color:#000
    style P4 fill:#6366f1,color:#fff
    style P5 fill:#6366f1,color:#fff
    style P6 fill:#fb923c,color:#fff
      </pre>
    </div>
    <table>
      <tr><th>Phase</th><th>Agent</th><th>Output</th></tr>
      <tr><td>1</td><td>Raj</td><td><code>data_model</code> ‚Äî Custom objects, fields, record types, page layouts</td></tr>
      <tr><td>2</td><td>Diego</td><td><code>business_logic</code> ‚Äî Apex triggers, classes, batch jobs, REST services</td></tr>
      <tr><td>3</td><td>Zara</td><td><code>ui_components</code> ‚Äî Lightning Web Components</td></tr>
      <tr><td>4</td><td>Raj</td><td><code>automation</code> ‚Äî Flows, validation rules, approval processes</td></tr>
      <tr><td>5</td><td>Raj</td><td><code>security</code> ‚Äî Permission sets, sharing rules, OWD</td></tr>
      <tr><td>6</td><td>Aisha</td><td><code>data_migration</code> ‚Äî Migration scripts, package.xml, deploy</td></tr>
    </table>
  </div>

  <!-- ==================== HITL & CHAT ==================== -->
  <div id="hitl" class="section">
    <h2>HITL & Chat Multi-Agent</h2>
    <p class="section-desc">Chat contextuel avec 9 agents (pas Diego/Zara, BUILD-only). Chaque agent charge ses deliverables comme contexte et maintient un historique s√©par√©.</p>

    <h3>Chat contextuel (9 agents)</h3>
    <table>
      <tr><th>Agent</th><th>Couleur</th><th>Contexte auto-charg√©</th><th>Sp√©cialit√© chat</th></tr>
      <tr><td>Sophie</td><td style="color:#8b5cf6">‚óº Purple</td><td>BRs, project overview</td><td>PM, cr√©ation de Change Requests</td></tr>
      <tr><td>Marcus</td><td style="color:#3b82f6">‚óº Blue</td><td>solution_design, wbs, gap_analysis</td><td>Architecture, data model, flows, security</td></tr>
      <tr><td>Olivia</td><td style="color:#34d399">‚óº Green</td><td>use_cases, uc_digest</td><td>Use cases, business logic</td></tr>
      <tr><td>Emma</td><td style="color:#06b6d4">‚óº Cyan</td><td>coverage_report, sds</td><td>Coverage, SDS validation</td></tr>
      <tr><td>Elena</td><td style="color:#f472b6">‚óº Pink</td><td>qa_plan</td><td>Test scenarios, risques</td></tr>
      <tr><td>Jordan</td><td style="color:#fbbf24">‚óº Yellow</td><td>devops_plan</td><td>CI/CD, environments, d√©ploiement</td></tr>
      <tr><td>Aisha</td><td style="color:#fb923c">‚óº Orange</td><td>data_migration_plan</td><td>Mappings, strat√©gies migration</td></tr>
      <tr><td>Lucas</td><td style="color:#14b8a6">‚óº Teal</td><td>training_plan</td><td>Modules de formation</td></tr>
      <tr><td>Raj</td><td style="color:#6366f1">‚óº Indigo</td><td>admin_config</td><td>Configuration, permissions, page layouts</td></tr>
    </table>

    <h3>Change Requests (CR)</h3>
    <p>Lifecycle complet : <code>draft ‚Üí submitted ‚Üí analyzed ‚Üí approved/rejected ‚Üí processing ‚Üí completed</code>. Sophie d√©tecte les demandes de CR dans le chat, cr√©e le CR, analyse l'impact (agents √† rerun + co√ªt estim√©), et l'utilisateur approuve/rejette.</p>

    <h3>Versioning</h3>
    <p>Chaque ex√©cution de CR cr√©e une nouvelle version du SDS. Historique des versions avec diff side-by-side.</p>
  </div>

  <!-- ==================== RAG ==================== -->
  <div id="rag" class="section">
    <h2>RAG & Knowledge Base</h2>
    <p class="section-desc">ChromaDB h√©berge 70,251 chunks de documentation Salesforce r√©partis en 5 collections th√©matiques.</p>
    <table>
      <tr><th>Collection</th><th>Embedding</th><th>Agents (via AGENT_COLLECTIONS)</th></tr>
      <tr><td><code>technical_collection</code></td><td>OpenAI</td><td>Marcus, Jordan, Raj, Elena, Aisha, Diego, Zara</td></tr>
      <tr><td><code>operations_collection</code></td><td>OpenAI</td><td>Marcus, Olivia, Jordan, Raj, Elena, Aisha, Lucas</td></tr>
      <tr><td><code>business_collection</code></td><td>OpenAI</td><td>Marcus, Olivia, Sophie, Lucas</td></tr>
      <tr><td><code>apex_collection</code></td><td>Nomic</td><td>Diego, Elena</td></tr>
      <tr><td><code>lwc_collection</code></td><td>Nomic</td><td>Zara</td></tr>
    </table>
    <p><strong>Statut :</strong> <span class="tag tag-done">OK</span> ‚Äî 70,251 chunks, 1.4 GB data + 2.3 GB total. PersistentClient local (pas de serveur s√©par√©).</p>
  </div>
  <!-- ==================== SERVICES ==================== -->
  <div id="infra" class="section">
    <h2>Services & Infrastructure</h2>
    <p class="section-desc">Tous les services sont g√©r√©s via <code>systemctl</code> sur Ubuntu 24.04.</p>
    <table>
      <tr><th>Service</th><th>systemctl unit</th><th>Port</th><th>Statut</th></tr>
      <tr><td>Backend API</td><td><code>digital-humans-backend</code></td><td>8002</td><td><span class="tag tag-done">active</span></td></tr>
      <tr><td>ARQ Worker</td><td><code>digital-humans-worker</code></td><td>‚Äî</td><td><span class="tag tag-done">active</span></td></tr>
      <tr><td>Frontend</td><td><code>digital-humans-frontend</code></td><td>3000</td><td><span class="tag tag-done">active</span></td></tr>
      <tr><td>PostgreSQL</td><td><code>postgresql</code></td><td>5432</td><td><span class="tag tag-done">active</span></td></tr>
      <tr><td>Redis</td><td><code>redis-server</code></td><td>6379</td><td><span class="tag tag-done">active</span></td></tr>
      <tr><td>ChromaDB</td><td>PersistentClient (embedded)</td><td>‚Äî</td><td><span class="tag tag-done">OK ‚Äî 70,251 chunks</span></td></tr>
      <tr><td>Ollama</td><td><code>ollama</code></td><td>11434</td><td><span class="tag tag-warning">OFF ‚Äî d√©sactiv√© volontairement (√©conomie RAM)</span></td></tr>
      <tr><td>Nginx</td><td><code>nginx</code></td><td>80/443</td><td><span class="tag tag-done">active</span></td></tr>
      <tr><td>Ghost CMS</td><td>Docker: <code>ghost-blog</code></td><td>2368</td><td><span class="tag tag-done">active</span></td></tr>
      <tr><td>N8N</td><td><code>n8n</code></td><td>5678</td><td><span class="tag tag-done">active</span></td></tr>
      <tr><td>Open WebUI</td><td>Docker: <code>open-webui</code></td><td>3200‚Üí8080</td><td><span class="tag tag-done">active</span></td></tr>
    </table>

    <h3>Commandes essentielles</h3>
    <table>
      <tr><th>Action</th><th>Commande</th></tr>
      <tr><td>Restart backend</td><td><code>sudo systemctl restart digital-humans-backend</code></td></tr>
      <tr><td>Restart worker</td><td><code>sudo systemctl restart digital-humans-worker</code></td></tr>
      <tr><td>Build frontend</td><td><code>cd frontend && npm run build && sudo systemctl restart digital-humans-frontend</code></td></tr>
      <tr><td>Logs backend</td><td><code>journalctl -u digital-humans-backend -f --no-pager | grep -v sqlalchemy</code></td></tr>
      <tr><td>Logs worker</td><td><code>journalctl -u digital-humans-worker -f --no-pager</code></td></tr>
      <tr><td>DB shell</td><td><code>sudo -u postgres psql digital_humans</code></td></tr>
      <tr><td>Health check</td><td><code>curl -s localhost:8002/api/health | jq</code></td></tr>
    </table>

    <h3>Admin Hub</h3>
    <p>Interface de monitoring centralis√©e accessible √† <code>digital-humans.fr/admin</code>. Permet de visualiser l'√©tat de tous les services, d√©marrer/arr√™ter/red√©marrer, consulter les logs, et monitorer Docker, Nginx, ChromaDB.</p>
    <table>
      <tr><th>Composant affich√©</th><th>Infos</th></tr>
      <tr><td>Backend / Frontend / Worker</td><td>Status UP/DOWN, port, latence, boutons start/stop/restart/logs</td></tr>
      <tr><td>N8N Workflows</td><td>15 workflows actifs, port 5678</td></tr>
      <tr><td>Ollama LLM</td><td>Status, mod√®les charg√©s, port 11434</td></tr>
      <tr><td>Ghost CMS</td><td>9 articles, 2 brouillons, port 2368</td></tr>
      <tr><td>PostgreSQL</td><td>Status, port 5432</td></tr>
      <tr><td>Docker</td><td>Containers open-webui + ghost-blog (CPU/RAM)</td></tr>
      <tr><td>Nginx</td><td>Status, test config, port 80</td></tr>
      <tr><td>RAG ChromaDB</td><td>70,251 chunks, 1.4 GB data, 2.3 GB total</td></tr>
    </table>
  </div>

  <!-- ==================== DATABASE ==================== -->
  <div id="database" class="section">
    <h2>Base de donn√©es</h2>
    <p class="section-desc">PostgreSQL 16 ‚Äî 41 tables.</p>
    <h3>Tables principales (m√©tier)</h3>
    <table>
      <tr><th>Table</th><th>Cols</th><th>R√¥le</th></tr>
      <tr><td><code>projects</code></td><td>51</td><td>Projets Salesforce (nom, description, config, settings)</td></tr>
      <tr><td><code>executions</code></td><td>22</td><td>Ex√©cutions SDS/BUILD (status, state, budget_used, cost_usd)</td></tr>
      <tr><td><code>agent_deliverables</code></td><td>10</td><td>Livrables JSON par agent et par ex√©cution</td></tr>
      <tr><td><code>execution_agents</code></td><td>7</td><td>Status/progress/tokens par agent</td></tr>
      <tr><td><code>agent_iterations</code></td><td>10</td><td>Historique it√©rations (Marcus revisions, Emma re-checks)</td></tr>
      <tr><td><code>validation_gates</code></td><td>13</td><td>D√©cisions HITL (gate_type, decision, feedback)</td></tr>
      <tr><td><code>project_conversations</code></td><td>10</td><td>Chat HITL multi-agent (agent_id, role, message)</td></tr>
      <tr><td><code>change_requests</code></td><td>21</td><td>CR lifecycle (status, impact_analysis, estimated_cost)</td></tr>
      <tr><td><code>sds_versions</code></td><td>11</td><td>Versioning des SDS (diff entre versions)</td></tr>
      <tr><td><code>business_requirements</code></td><td>17</td><td>BRs extraites par Sophie</td></tr>
      <tr><td><code>uc_requirement_sheets</code></td><td>17</td><td>Use Cases structur√©es par Olivia</td></tr>
      <tr><td><code>llm_interactions</code></td><td>18</td><td>Log appels LLM (model, tokens, cost_usd)</td></tr>
      <tr><td><code>build_phase_executions</code></td><td>21</td><td>Suivi phases BUILD</td></tr>
      <tr><td><code>task_executions</code></td><td>29</td><td>T√¢ches BUILD individuelles</td></tr>
    </table>
    <h3>Tables secondaires</h3>
    <p><code>audit_logs</code> (22), <code>quality_gates</code> (11), <code>execution_artifacts</code> (16), <code>project_environments</code> (21), <code>project_credentials</code> (8), <code>project_git_config</code> (17), <code>project_documents</code> (12), <code>project_data_sources</code> (11), <code>sds_templates</code> (20), <code>users</code> (11), <code>agents</code> (6), <code>deliverable_items</code> (14)</p>
    <p>Marketing : <code>leads</code>, <code>prospects</code>, <code>blog_articles</code>, <code>blog_topics</code>, <code>linkedin_posts</code>, <code>outreach_emails</code>, <code>newsletter_sends</code>, <code>meeting_requests</code>, <code>veille_reports</code></p>
  </div>
  <!-- ==================== API REFERENCE ==================== -->
  <div id="api" class="section">
    <h2>API Reference</h2>
    <p class="section-desc">178 endpoints REST r√©partis sur 29 fichiers. Pr√©fixe <code>/api/pm-orchestrator/</code> (orchestrateur) ou <code>/api/</code>.</p>

    <h3>Projets</h3>
    <table>
      <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
      <tr><td>POST</td><td><code>/api/pm-orchestrator/projects</code></td><td>Cr√©er un projet</td></tr>
      <tr><td>GET</td><td><code>/api/pm-orchestrator/projects</code></td><td>Lister les projets</td></tr>
      <tr><td>GET</td><td><code>.../projects/{id}</code></td><td>D√©tail</td></tr>
      <tr><td>PUT</td><td><code>.../projects/{id}</code></td><td>Modifier</td></tr>
      <tr><td>GET</td><td><code>.../dashboard/stats</code></td><td>Stats tableau de bord</td></tr>
    </table>

    <h3>Ex√©cutions SDS</h3>
    <table>
      <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
      <tr><td>POST</td><td><code>.../execute</code></td><td>D√©marrer ex√©cution SDS (‚Üí ARQ queue)</td></tr>
      <tr><td>POST</td><td><code>.../execute/{id}/resume</code></td><td>Reprendre apr√®s gate (approve/revise)</td></tr>
      <tr><td>GET</td><td><code>.../execute/{id}/progress</code></td><td>Progression temps r√©el</td></tr>
      <tr><td>GET</td><td><code>.../execute/{id}/progress/stream</code></td><td>SSE streaming</td></tr>
      <tr><td>GET</td><td><code>.../execute/{id}/result</code></td><td>R√©sultat final</td></tr>
      <tr><td>POST</td><td><code>.../execute/{id}/retry</code></td><td>Retry ex√©cution</td></tr>
    </table>

    <h3>Validation Gates</h3>
    <table>
      <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
      <tr><td>GET</td><td><code>.../execute/{id}/validation-gate</code></td><td>√âtat du gate actuel</td></tr>
      <tr><td>POST</td><td><code>.../execute/{id}/validation-gate/submit</code></td><td>Approve/reject + feedback</td></tr>
      <tr><td>GET</td><td><code>.../execute/{id}/validation-history</code></td><td>Historique validations</td></tr>
      <tr><td>GET/PUT</td><td><code>.../projects/{id}/validation-gates</code></td><td>Config des gates (on/off)</td></tr>
    </table>

    <h3>HITL ‚Äî Chat & Change Requests</h3>
    <table>
      <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
      <tr><td>POST</td><td><code>/api/hitl/executions/{id}/chat</code></td><td>Chat multi-agent (body: message, agent_id)</td></tr>
      <tr><td>GET</td><td><code>.../executions/{id}/agents</code></td><td>Agents disponibles</td></tr>
      <tr><td>GET</td><td><code>.../executions/{id}/chat/history</code></td><td>Historique par agent</td></tr>
      <tr><td>GET</td><td><code>.../executions/{id}/metrics</code></td><td>M√©triques (co√ªts, tokens)</td></tr>
      <tr><td>GET</td><td><code>.../projects/{id}/change-requests</code></td><td>Liste CRs</td></tr>
      <tr><td>POST</td><td><code>.../change-requests/{id}/analyze</code></td><td>Analyse d'impact</td></tr>
      <tr><td>POST</td><td><code>.../change-requests/{id}/approve</code></td><td>Approuver CR</td></tr>
      <tr><td>POST</td><td><code>.../change-requests/{id}/execute</code></td><td>Ex√©cuter CR</td></tr>
    </table>

    <h3>Deliverables</h3>
    <table>
      <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
      <tr><td>GET</td><td><code>/api/deliverables/executions/{id}/previews</code></td><td>Previews de tous les livrables</td></tr>
      <tr><td>GET</td><td><code>/api/deliverables/{id}/full</code></td><td>Contenu complet (JSON/Markdown)</td></tr>
      <tr><td>GET</td><td><code>.../executions/{id}/agents/{agent}</code></td><td>Livrables par agent</td></tr>
      <tr><td>GET</td><td><code>/api/hitl/deliverables/{id}/versions</code></td><td>Historique versions</td></tr>
      <tr><td>GET</td><td><code>/api/hitl/deliverables/{id}/diff</code></td><td>Diff side-by-side</td></tr>
    </table>

    <h3>BUILD</h3>
    <table>
      <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
      <tr><td>POST</td><td><code>.../projects/{id}/start-build</code></td><td>D√©marrer BUILD (‚Üí ARQ)</td></tr>
      <tr><td>GET</td><td><code>.../execute/{id}/build-phases</code></td><td>Progression phases BUILD</td></tr>
      <tr><td>GET</td><td><code>.../execute/{id}/build-tasks</code></td><td>D√©tail t√¢ches BUILD</td></tr>
    </table>
  </div>

  <!-- ==================== FRONTEND ==================== -->
  <div id="frontend" class="section">
    <h2>Frontend</h2>
    <p class="section-desc">React 18 + Vite + TailwindCSS. 13 pages, 19 composants sp√©cialis√©s.</p>
    <h3>Pages</h3>
    <table>
      <tr><th>Page</th><th>Route</th><th>Description</th></tr>
      <tr><td><code>Dashboard</code></td><td>/</td><td>Vue d'ensemble, stats, derni√®res ex√©cutions</td></tr>
      <tr><td><code>Projects</code></td><td>/projects</td><td>Liste des projets</td></tr>
      <tr><td><code>ProjectDetailPage</code></td><td>/projects/{id}</td><td>D√©tail projet, CRs, SDS versions</td></tr>
      <tr><td><code>ExecutionMonitoringPage</code></td><td>/execution/{id}</td><td>Timeline, deliverables, chat, HITL gates</td></tr>
      <tr><td><code>BRValidationPage</code></td><td>/br-validation/{id}</td><td>Validation des Business Requirements</td></tr>
      <tr><td><code>BuildMonitoringPage</code></td><td>/build/{id}</td><td>Suivi BUILD, code preview</td></tr>
      <tr><td><code>ProjectWizard</code></td><td>/wizard</td><td>Assistant cr√©ation projet</td></tr>
      <tr><td><code>AgentTesterPage</code></td><td>/agent-tester</td><td>Test individuel d'agents</td></tr>
      <tr><td><code>LoginPage</code></td><td>/login</td><td>Authentification JWT</td></tr>
    </table>
    <h3>Composants cl√©s</h3>
    <table>
      <tr><th>Composant</th><th>R√¥le</th></tr>
      <tr><td><code>TimelineStepper</code></td><td>Timeline 5 phases (pending/active/waiting_hitl/completed/failed)</td></tr>
      <tr><td><code>ArchitectureReviewPanel</code></td><td>ERD Mermaid, Flows accord√©ons, WBS Gantt, Security OWD</td></tr>
      <tr><td><code>StructuredRenderer</code></td><td>Route JSON deliverables ‚Üí UI typ√©e (BR table, coverage grid, expert specs)</td></tr>
      <tr><td><code>DeliverableViewer</code></td><td>D√©tecte type (JSON/Markdown/Mermaid) ‚Üí bon renderer</td></tr>
      <tr><td><code>ChatSidebar</code></td><td>Chat multi-agent 9 agents, color-coded, historique par agent</td></tr>
      <tr><td><code>ValidationGatePanel</code></td><td>Approve/Reject + feedback texte</td></tr>
      <tr><td><code>SDSPreview</code></td><td>Rendu Markdown avec TOC et Mermaid inline</td></tr>
      <tr><td><code>GanttChart</code></td><td>Timeline WBS (dur√©e, d√©pendances)</td></tr>
      <tr><td><code>MermaidRenderer</code></td><td>Mermaid code ‚Üí SVG</td></tr>
      <tr><td><code>ExecutionMetrics</code></td><td>Dashboard co√ªts, tokens, dur√©e par agent</td></tr>
      <tr><td><code>DiffViewer</code></td><td>Diff side-by-side versions SDS</td></tr>
      <tr><td><code>BuildPhasesPanel</code></td><td>Suivi 6 phases BUILD avec code preview</td></tr>
    </table>
  </div>
  <!-- ==================== PROBL√àMES ==================== -->
  <div id="problems" class="section">
    <h2>Probl√®mes architecturaux (P0-P9)</h2>
    <p class="section-desc">10 probl√®mes identifi√©s lors de l'audit. 5 fix√©s, 3 partiels, 2 restants.</p>
    <div class="card-grid">
      <div class="card">
        <h4 style="color:var(--green)">‚úÖ Fix√©s (5)</h4>
        <p><strong>P0</strong> async def ‚Üí sync def (S0)<br>
        <strong>P1</strong> pm.py supprim√© (S0)<br>
        <strong>P2</strong> paths centralis√©s config.py (S0)<br>
        <strong>P6</strong> 13 hardcoded models ‚Üí YAML (13 f√©v)<br>
        <strong>P9</strong> safe_content() limits √ó6 (13 f√©v)</p>
      </div>
      <div class="card">
        <h4 style="color:var(--orange)">‚ö†Ô∏è Partiels (3)</h4>
        <p><strong>P3</strong> subprocess ‚Üí asyncio.create_subprocess (S1) ‚Äî toujours subprocess pas import<br>
        <strong>P4</strong> Routes split√©es 6 fichiers (S2) ‚Äî service 3396 lignes<br>
        <strong>P8</strong> SECRET_KEY valid√© en prod (S3) ‚Äî pas de rotation</p>
      </div>
      <div class="card">
        <h4 style="color:var(--red)">‚ùå Planifi√©s (2)</h4>
        <p><strong>P5</strong> Logs fragment√©s ‚Äî <code>import logging</code> basique<br>
        <strong>P7</strong> Transactions ‚Äî 24 <code>db.commit()</code> √©parpill√©s</p>
      </div>
    </div>
  </div>

  <!-- ==================== PLAN DE REFONTE ==================== -->
  <div id="refonte" class="section">
    <h2>Plan de refonte 2026</h2>
    <p class="section-desc">Refonte architecturale utilisant Claude Code Agent Teams (Opus 4.6). M√©thodologie anti-r√©gression avec tags git et baseline tests.</p>

    <h3>Strat√©gie Agent Teams</h3>
    <div class="mermaid-wrapper">
      <pre class="mermaid">
flowchart TB
    subgraph P1["Phase 1 ‚Äî L'Architecte"]
        A1["1 agent Opus ‚Äî Fen√™tre 1M tokens ‚Äî Analyse repo 680K tokens"]
    end
    subgraph P2["Phase 2 ‚Äî Les Sp√©cialistes ‚Äî parall√®le"]
        direction LR
        S["Stabilizer P0+P1+P2 ‚Äî Termin√©"]
        R["Refactorer P3 11 agents ‚Äî Partiel"]
        M["Modernizer P4+P7 ‚Äî Partiel"]
    end
    subgraph P3["Phase 3 ‚Äî L'Int√©grateur"]
        I1["Smoke tests + Contrats + Tag git"]
    end
    P1 -->|Docs r√©f√©rence| P2
    P2 --> P3
    style P1 fill:#151922,stroke:#4f8cff,stroke-width:2px
    style P2 fill:#151922,stroke:#34d399,stroke-width:2px
    style P3 fill:#151922,stroke:#a78bfa,stroke-width:2px
      </pre>
    </div>

    <h3>Planning</h3>
    <table>
      <tr><th>Semaine</th><th>Phase</th><th>Actions</th><th>Statut</th></tr>
      <tr><td>S1</td><td>Phase 1</td><td>Architecte : analyse + 5 docs r√©f√©rence</td><td><span class="tag tag-done">‚úÖ Termin√©</span></td></tr>
      <tr><td>S2</td><td>Sprint 0</td><td>Stabilizer : P0 (async) + P1 (dead code) + P2 (paths)</td><td><span class="tag tag-done">‚úÖ Termin√©</span></td></tr>
      <tr><td>S3</td><td>Sprint 1+2</td><td>Refactorer P3 (subprocess‚Üíasync) + Modernizer P4/P7</td><td><span class="tag tag-done">‚úÖ Termin√©</span></td></tr>
      <tr><td>S4</td><td>Sprint 3</td><td>P5 logging + P6 LLM router + P8 secrets</td><td><span class="tag tag-done">‚úÖ Termin√©</span></td></tr>
      <tr><td>S5</td><td>Horizons 2+3</td><td>10 streams : State Machine, ARQ, Budget, RAG, UX, HITL, Prompts</td><td><span class="tag tag-done">‚úÖ Merg√© (10 f√©v)</span></td></tr>
      <tr><td>S6</td><td>Sprint I</td><td>E2E #140‚Üí#142 + 16 fixes + HITL coverage gate</td><td><span class="tag tag-done">‚úÖ Termin√© (11 f√©v)</span></td></tr>
      <tr><td>S7</td><td>E2E #143+#144</td><td>Coverage fix (45%‚Üí90.3%), 30 bugs, Plan V2</td><td><span class="tag tag-done">‚úÖ Termin√© (12 f√©v)</span></td></tr>
      <tr><td>S7.5</td><td>Tracks A+B+C</td><td>7 bugs backend, ArchitectureReviewPanel, StructuredRenderer, ChatSidebar multi-agent, fix_gaps</td><td><span class="tag tag-done">‚úÖ Termin√© (13 f√©v)</span></td></tr>
      <tr><td>S8</td><td>E2E #145</td><td>Validation compl√®te post-fixes</td><td><span class="tag tag-active">üîÑ Prochain</span></td></tr>
      <tr><td>S9</td><td>P10</td><td>Agent Architecture Debt : BaseAgent class</td><td><span class="tag tag-pending">Planifi√©</span></td></tr>
      <tr><td>S10</td><td>Agent Teams</td><td>Refonte finale Claude Code Agent Teams</td><td><span class="tag tag-pending">Planifi√© (fin f√©v)</span></td></tr>
    </table>
  </div>

  <!-- ==================== JOURNAL ==================== -->
  <div id="journal" class="section">
    <h2>Journal de la refonte</h2>
    <p class="section-desc">Timeline des √©v√©nements, d√©cisions et r√©sultats.</p>
    <div class="timeline">
      <div class="timeline-item done">
        <div class="timeline-date">5 f√©v 2026</div>
        <div class="timeline-title">Audit technique exhaustif</div>
        <div class="timeline-desc">Analyse statique (Claude) + contextuelle (Gemini). 15 probl√®mes, 5 critiques. Plan P0‚ÜíP8.</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">6 f√©v 2026</div>
        <div class="timeline-title">Playbook de migration + Blueprint Agent Teams</div>
        <div class="timeline-desc">Plan d'ex√©cution anti-r√©gression. 6 agents d√©finis.</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">7 f√©v 2026</div>
        <div class="timeline-title">Fix r√¥les agents + P9 SDS Sections</div>
        <div class="timeline-desc">Olivia=BA, Marcus=Architect. D√©couverte troncature critique safe_content().</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">7-8 f√©v 2026</div>
        <div class="timeline-title">Sprints 0‚Üí3 ‚Äî Refonte backend</div>
        <div class="timeline-desc">S0: P0+P1+P2. S1: P3 subprocess‚Üíasync. S2: P4 fat controller split. S3: P5+P6+P8.</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">8-9 f√©v 2026</div>
        <div class="timeline-title">Sprint H ‚Äî Horizons 2+3 (10 streams)</div>
        <div class="timeline-desc">State Machine 27 √©tats, ARQ workers, BudgetService + CircuitBreaker, HITL routes, Mermaid/Gantt/Metrics/DiffViewer.</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">10-11 f√©v 2026</div>
        <div class="timeline-title">Sprint I ‚Äî E2E #140 ‚Üí #142</div>
        <div class="timeline-desc">#140: P0+P1 pass. #141: Phase 4 pass, P5 crash. #142: üéâ Premier run complet Phases 1‚Üí5 (33 BRs ‚Üí 165 UCs ‚Üí SDS, ~$13.59).</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">12 f√©v 2026</div>
        <div class="timeline-title">E2E #143 ‚Äî Coverage scoring fix</div>
        <div class="timeline-desc">Bug Emma: UC format mismatch + weight imbalance. M√™me design Marcus scorait 45% au lieu de 90.3%.</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">12 f√©v 2026</div>
        <div class="timeline-title">E2E #144 ‚Äî 30 bugs identifi√©s, Plan V2</div>
        <div class="timeline-desc">SDS docx vide, co√ªt 262% sous-report√©, safe_content() tronque 93-96%, 13 mod√®les hardcod√©s.</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">13 f√©v 2026</div>
        <div class="timeline-title">üîß Track A ‚Äî Backend Cleanup (7 bugs)</div>
        <div class="timeline-desc">4 key mismatches fix√©s, safe_content √ó6, MODEL_PRICING, 13 models‚ÜíYAML, anti-markdown Marcus.</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">13 f√©v 2026</div>
        <div class="timeline-title">üé® Track B+C ‚Äî Frontend rewrite</div>
        <div class="timeline-desc">ArchitectureReviewPanel (ERD, Flows, WBS Gantt, Security OWD). StructuredRenderer (BRs, coverage, experts).</div>
      </div>
      <div class="timeline-item done">
        <div class="timeline-date">13 f√©v 2026</div>
        <div class="timeline-title">üí¨ Sprint 4+5 ‚Äî Multi-agent Chat + Revision Fix</div>
        <div class="timeline-desc">9 agents color-coded, historique par agent, fix_gaps mode incr√©mental.</div>
      </div>
      <div class="timeline-item active">
        <div class="timeline-date">14 f√©v 2026</div>
        <div class="timeline-title">üìù Documentation site ‚Äî r√©√©criture compl√®te</div>
        <div class="timeline-desc">Toutes sections v√©rifi√©es sur VPS : architecture, workers ARQ, state machine, DB 41 tables, API 178 endpoints, frontend 13 pages / 19 composants.</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">F√©vrier 2026</div>
        <div class="timeline-title">E2E #145 + Agent Teams</div>
        <div class="timeline-desc">Validation finale post-fixes puis refonte Claude Code Agent Teams.</div>
      </div>
    </div>
  </div>

</main>
<script>
  // Navigation
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    event.target.classList.add('active');
    window.scrollTo(0, 0);
  }

  // Mermaid init
  mermaid.initialize({
    startOnLoad: false,
    theme: 'dark',
    themeVariables: {
      primaryColor: '#1e2433',
      primaryTextColor: '#c8cdd8',
      primaryBorderColor: '#4f8cff',
      lineColor: '#4f8cff',
      secondaryColor: '#151922',
      tertiaryColor: '#151922',
      fontFamily: 'DM Sans, sans-serif',
      fontSize: '13px'
    },
    flowchart: { curve: 'basis', padding: 16 },
    sequence: { actorMargin: 40, messageMargin: 30 }
  });

  // Render mermaid on section change
  async function renderMermaid() {
    const elements = document.querySelectorAll('.section.active .mermaid');
    for (const el of elements) {
      if (!el.getAttribute('data-processed')) {
        const { svg } = await mermaid.render('mermaid-' + Math.random().toString(36).substr(2, 9), el.textContent);
        el.innerHTML = svg;
        el.setAttribute('data-processed', 'true');
      }
    }
  }

  // Override showSection to also render mermaid
  const originalShow = showSection;
  showSection = function(id) {
    originalShow(id);
    setTimeout(renderMermaid, 50);
  };

  // Initial render
  document.addEventListener('DOMContentLoaded', () => setTimeout(renderMermaid, 100));
</script>

</body>
</html>
